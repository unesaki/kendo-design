== アカウント管理機能

=== 機能概要

ユーザが本サービスを利用するために必要な基本的なアカウント機能を提供する。これには、ユーザ登録、ログイン、ログアウト、パスワードの管理などが含まれる。

=== 詳細設計書

本機能の詳細な技術仕様については、以下の詳細設計書を参照すること：

* link:../accountManagement/login.adoc[ログインAPI 詳細設計書]
* link:../accountManagement/register.adoc[新規登録API 詳細設計書]  
* link:../accountManagement/logout.adoc[ログアウトAPI 詳細設計書]
* link:../accountManagement/email-verification.adoc[メール認証API 詳細設計書]
* link:../accountManagement/password-reset.adoc[パスワードリセットAPI 詳細設計書]

=== 対象ユーザ

全ユーザ（クラブ管理者・参加者を問わない）

=== 機能一覧と詳細

[cols="1,2,2", options="header"]
|===
| 機能名 | 説明 | 条件・補足

| ユーザ登録
| サービス利用に必要なユーザアカウントを作成する
| * メールアドレス、パスワード、名前を登録  
  * 登録後にクラブ作成または参加申請が可能になる

| ログイン
| 登録済ユーザがサービスにログインする
| * メールアドレス＋パスワード認証  
  * JWT式を採用

| ログアウト
| ログイン状態を解除する
| * クライアント上のトークン削除

| パスワード再設定
| パスワードを忘れた場合に再設定を行う
| * 登録済みメールアドレスにリセットリンク送付

| プロフィール確認・編集
| 自身のユーザ情報を確認・変更する
| * 名前や表示用アイコンなどの更新が可能  
  * メールアドレスの変更は再認証を必要とする場合あり
|===

=== セキュリティ要件

* パスワードはハッシュ化して保存（BCrypt想定）
* パスワードポリシー：英数字8文字以上、記号推奨
* 不正アクセス対策：ログイン試行回数制限、reCAPTCHA導入も検討
* JWTトークンの有効期限は24時間とし、有効期限を過ぎた場合は再ログインを必要とする
* リフレッシュトークンの導入は将来的に検討する

=== ユーザ登録時の初期状態

* 所属クラブ：未所属（＝クラブ作成 or クラブ参加申請を促す）
* ロール：未設定（クラブ参加後にロールが決定される）

=== パスワード再設定のフロー

* 再設定は、登録済みメールアドレスへの「リセット用リンク送信」方式を採用する。
* リンクにはトークンを含め、トークンの有効期限は1時間とする。

=== プロフィール項目の範囲

* 編集可能項目：名前（表示名）、ニックネーム、プロフィール画像（アイコン）
* メールアドレスの変更時は本人確認のための再認証を要する。

=== メール認証の有無

* ユーザ登録後、初回ログイン前にメール認証を必須とする。
* メール未認証状態ではクラブ作成・参加申請などの機能を制限する。

=== アカウントの有効/無効状態制御

* 今後の運用を見越して、アカウントには有効／無効のフラグを持たせる。
* 管理者によるBAN、一時停止対応を可能とする（初版では未使用でも設計には含める）。

